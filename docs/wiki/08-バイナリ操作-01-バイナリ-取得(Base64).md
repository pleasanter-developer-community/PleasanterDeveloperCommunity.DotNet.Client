# 添付ファイルの取得（Base64形式） - binaries/{guid}/get

## 概要

APIを使用して添付ファイルをBase64形式で取得します。ファイルのメタデータ（ファイル名、サイズ、コンテンツタイプなど）も含めて取得できます。

## 対応バージョン

- プリザンター 1.3.13.0以降
  - このライブラリの制約によるもの

## メソッド

```csharp
// パラメータ指定版
Task<ApiResponse<AttachmentResponse>> GetAttachmentAsync(
    string guid,
    TimeSpan? timeout = null)

// リクエストモデル版
Task<ApiResponse<AttachmentResponse>> GetAttachmentAsync(
    string guid,
    GetAttachmentRequest request,
    TimeSpan? timeout = null)
```

## パラメータ

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `guid` | string | Yes | 添付ファイルのGUID |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

## レスポンス

`AttachmentResponse` には以下のプロパティが含まれます：

| プロパティ | 型 | 説明 |
|------------|------|------|
| `ReferenceId` | long | レコードID |
| `BinaryType` | string? | バイナリタイプ |
| `Base64` | string? | Base64エンコードされたファイルデータ |
| `Guid` | string? | ファイルのGUID |
| `FileNameWithoutExtension` | string? | 拡張子なしのファイル名 |
| `Extension` | string? | ファイルの拡張子 |
| `Size` | long | ファイルサイズ（バイト） |
| `ContentType` | string? | コンテンツタイプ（MIMEタイプ） |
| `Creator` | long | 作成者ID |
| `Updator` | long | 更新者ID |
| `CreatedTime` | DateTime? | 作成日時 |
| `UpdatedTime` | DateTime? | 更新日時 |
| `FileName` | string | 完全なファイル名（FileNameWithoutExtension + Extension） |

## 使用例

### 基本的な添付ファイル取得

```csharp
var result = await client.GetAttachmentAsync(guid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx");

if (result.IsSuccess && result.Data != null)
{
    Console.WriteLine($"ファイル名: {result.Data.FileName}");
    Console.WriteLine($"サイズ: {result.Data.Size} bytes");
    Console.WriteLine($"コンテンツタイプ: {result.Data.ContentType}");
}
```

### ファイルをダウンロードして保存

```csharp
var result = await client.GetAttachmentAsync(guid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx");

if (result.IsSuccess && result.Data?.Base64 != null)
{
    // Base64をバイト配列にデコード
    var bytes = Convert.FromBase64String(result.Data.Base64);
    
    // ファイルに保存
    var fileName = result.Data.FileName ?? "downloaded_file";
    await File.WriteAllBytesAsync(fileName, bytes);
    
    Console.WriteLine($"ファイル '{fileName}' をダウンロードしました");
}
```

### デコードヘルパーメソッドを使用

```csharp
var result = await client.GetAttachmentAsync(guid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx");

if (result.IsSuccess && result.Data != null)
{
    // レスポンスに含まれるヘルパーメソッドを使用
    byte[]? bytes = result.Data.ToByteArray();
    
    if (bytes != null)
    {
        await File.WriteAllBytesAsync(result.Data.FileName, bytes);
    }
}
```

### リクエストモデルを使用

```csharp
using PleasanterDeveloperCommunity.DotNet.Client.Models.Requests.Binaries;

var request = new GetAttachmentRequest();

var result = await client.GetAttachmentAsync(
    guid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
    request: request);

if (result.IsSuccess && result.Data != null)
{
    Console.WriteLine($"ファイル名: {result.Data.FileName}");
}
```

## レスポンスJSON例

### 成功時

```json
{
  "ReferenceId": 12345,
  "BinaryType": "Attachments",
  "Base64": "SGVsbG8gV29ybGQh...",
  "Guid": "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx",
  "FileNameWithoutExtension": "document",
  "Extension": ".pdf",
  "Size": 102400,
  "ContentType": "application/pdf",
  "Creator": 1,
  "Updator": 1,
  "CreatedTime": "2024-01-15T10:30:00",
  "UpdatedTime": "2024-01-15T10:30:00"
}
```

### エラー時

```json
{
  "Id": 0,
  "StatusCode": 404,
  "Message": "対象のデータが見つかりませんでした。"
}
```

## レスポンスの処理

```csharp
var result = await client.GetAttachmentAsync(guid: "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx");

if (result.IsSuccess)
{
    // 成功時の処理
    if (result.Data?.Base64 != null)
    {
        var bytes = Convert.FromBase64String(result.Data.Base64);
        Console.WriteLine($"ファイルサイズ: {bytes.Length} bytes");
    }
}
else
{
    // エラー時の処理
    Console.WriteLine($"エラー: {result.StatusCode} - {result.Message}");
}
```

## 注意事項

- 大きなファイルを取得する場合はメモリ使用量に注意してください
- Base64エンコードされたデータはオリジナルの約1.33倍のサイズになります
- 大きなファイルの場合は `GetBinaryStreamAsync` の使用を検討してください

## 関連項目

- [バイナリストリームの取得](08-バイナリ操作-02-バイナリ-ストリーム取得)
- [バイナリのアップロード](08-バイナリ操作-03-バイナリ-アップロード)
- [レコードの取得（添付ファイル）](01-テーブル操作-05-レコード-取得(添付ファイル))
