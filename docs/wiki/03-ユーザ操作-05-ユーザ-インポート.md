# ユーザのインポート - users/import

## 概要

CSVファイルをインポートして、ユーザを一括で作成・更新します。

## 対応バージョン

- プリザンター 1.3.13.0以降
  - このライブラリの制約によるもの

## 必要な権限

- テナント管理者

## メソッド

```csharp
// byte[]版
Task<ApiResponse<ImportResponse>> ImportUsersAsync(byte[] csvData, string fileName, Encoding? encoding = null, TimeSpan? timeout = null)

// Stream版
Task<ApiResponse<ImportResponse>> ImportUsersAsync(Stream csvStream, string fileName, Encoding? encoding = null, TimeSpan? timeout = null)

// ファイルパス版
Task<ApiResponse<ImportResponse>> ImportUsersFromFileAsync(string filePath, Encoding? encoding = null, TimeSpan? timeout = null)
```

## パラメータ

### byte[]版 (`ImportUsersAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `csvData` | byte[] | ✓ | CSVファイルのバイナリデータ |
| `fileName` | string | ✓ | ファイル名 |
| `encoding` | Encoding? | | CSVファイルのエンコーディング（`Encoding.UTF8` または `Encoding.GetEncoding(932)`、デフォルト: `Encoding.UTF8`） |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

### Stream版 (`ImportUsersAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `csvStream` | Stream | ✓ | CSVファイルのストリーム |
| `fileName` | string | ✓ | ファイル名 |
| `encoding` | Encoding? | | CSVファイルのエンコーディング（`Encoding.UTF8` または `Encoding.GetEncoding(932)`、デフォルト: `Encoding.UTF8`） |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

### ファイルパス版 (`ImportUsersFromFileAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `filePath` | string | ✓ | CSVファイルのパス |
| `encoding` | Encoding? | | CSVファイルのエンコーディング。省略時はファイル内容から自動判定されます。 |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

## 使用例

### 基本的なインポート

```csharp
// CSVファイルを読み込んでインポート
var csvData = File.ReadAllBytes("users.csv");

var result = await client.ImportUsersAsync(
    csvData: csvData,
    fileName: "users.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

### ファイルパスを指定してインポート（推奨）

```csharp
// ファイルパスを直接指定してインポート（最もシンプル）
// encodingを省略するとファイル内容から自動判定
var result = await client.ImportUsersFromFileAsync(
    filePath: @"C:\data\users.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

### UTF-8エンコーディングでインポート

```csharp
using System.Text;

var csvData = File.ReadAllBytes("users.csv");

var result = await client.ImportUsersAsync(
    csvData: csvData,
    fileName: "users.csv",
    encoding: Encoding.UTF8);  // 省略可能（デフォルト）
```

### Shift-JISエンコーディングでインポート

```csharp
using System.Text;

var csvData = File.ReadAllBytes("users_sjis.csv");

var result = await client.ImportUsersAsync(
    csvData: csvData,
    fileName: "users_sjis.csv",
    encoding: Encoding.GetEncoding(932));  // Shift-JIS
```

### Streamを使用したインポート

```csharp
using var fileStream = File.OpenRead(@"C:\data\users.csv");

var result = await client.ImportUsersAsync(
    csvStream: fileStream,
    fileName: "users.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

## レスポンス

### 成功時

```json
{
  "Id": 0,
  "StatusCode": 200,
  "Message": "10件のユーザをインポートしました。"
}
```

### エラー時

```json
{
  "Id": 0,
  "StatusCode": 403,
  "Message": "権限がありません。"
}
```

## レスポンスの処理

```csharp
var result = await client.ImportUsersFromFileAsync(@"C:\data\users.csv");

if (result.IsSuccess)
{
    // 成功時の処理
    Console.WriteLine($"メッセージ: {result.Message}");
}
else
{
    // エラー時の処理
    Console.WriteLine($"エラー: {result.StatusCode} - {result.Message}");
}
```

## CSVフォーマット

CSVファイルには以下の列を含めることができます：

| 列名 | 説明 | 必須 |
|------|------|:----:|
| `LoginId` | ログインID | ✓ |
| `Name` | 名前 | ✓ |
| `Password` | パスワード | |
| `DeptCode` | 組織コード | |
| `FirstName` | 名 | |
| `LastName` | 姓 | |
| `Birthday` | 誕生日 | |
| `Gender` | 性別 | |
| `Language` | 言語 | |
| `TimeZone` | タイムゾーン | |
| `Disabled` | 無効フラグ | |
| `Lockout` | ロックアウトフラグ | |

> **Note:** CSVの詳細なフォーマットについては、[プリザンター公式マニュアル](https://pleasanter.org/ja/manual)を参照してください。

## 注意事項

- テナント管理者権限が必要です
- 既存のユーザは `LoginId` をキーとして更新されます
- パスワードを含める場合、適切なセキュリティ対策を講じてください

## 関連項目

- [ユーザの取得](03-ユーザ操作-01-ユーザ-取得)
- [ユーザの作成](03-ユーザ操作-02-ユーザ-作成)
- [ユーザの更新](03-ユーザ操作-03-ユーザ-更新)
- [ユーザの削除](03-ユーザ操作-04-ユーザ-削除)
