# 添付ファイル取得 - binaries/{guid}/get

## 概要

添付ファイル項目に添付したファイルや、内容や説明項目およびコメントに貼り付けた画像ファイルの情報を取得します。

## 対応バージョン

- プリザンター 1.3.13.0以降
  - このライブラリの制約によるもの

## メソッド

```csharp
// パラメータ指定版
Task<ApiResponse<AttachmentResponse>> GetAttachmentAsync(string guid, TimeSpan? timeout = null)

// リクエストモデル版
Task<ApiResponse<AttachmentResponse>> GetAttachmentAsync(string guid, GetAttachmentRequest request, TimeSpan? timeout = null)
```

## パラメータ

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `guid` | string | Yes | 添付ファイルのGUID |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

## レスポンス

`AttachmentResponse` には以下のプロパティが含まれます：

| プロパティ | 型 | 説明 |
|------|------|------|
| `ReferenceId` | long | ファイルが紐づいているレコードのID |
| `BinaryType` | string | バイナリタイプ（Attachments: 添付ファイル, Images: 画像） |
| `Base64` | string | Base64エンコードされたファイルの内容 |
| `Guid` | string | ファイルのGUID |
| `FileNameWithoutExtension` | string | ファイル名（拡張子なし） |
| `Extension` | string | 拡張子 |
| `FileName` | string | ファイル名と拡張子を結合した完全なファイル名（例: "document.pdf"） |
| `Size` | long | ファイルサイズ（バイト単位） |
| `ContentType` | string | ファイルのMIMEタイプ |
| `Creator` | long | ファイル作成者のユーザID |
| `Updator` | long | ファイル更新者のユーザID |
| `CreatedTime` | DateTime? | ファイル作成日時 |
| `UpdatedTime` | DateTime? | ファイル更新日時 |

## 使用例

### 添付ファイル情報の取得

```csharp
// 添付ファイルのGUIDを指定して取得
var response = await client.GetAttachmentAsync(guid: "5e23245xxxxxxxxxxxxxxxxxxxxxxxxxxxx");

if (response.IsSuccess && response.Response != null)
{
    Console.WriteLine($"ファイル名: {response.Response.FileName}");
    Console.WriteLine($"サイズ: {response.Response.Size} bytes");
    Console.WriteLine($"ContentType: {response.Response.ContentType}");
}
```

### ファイルとして保存

```csharp
var response = await client.GetAttachmentAsync(guid: "5e23245xxxxxxxxxxxxxxxxxxxxxxxxxxxx");

if (response.IsSuccess && response.Response != null)
{
    // 方法1: ディレクトリを指定して元のファイル名で保存
    var savedPath = await response.Response.SaveToDirectoryAsync(@"C:\Downloads");
    Console.WriteLine($"保存先: {savedPath}");
    
    // 方法2: 完全なファイルパスを指定して保存
    await response.Response.SaveToFileAsync(@"C:\Downloads\custom_name.txt");
    
    // 方法3: 同期バージョンも使用可能
    response.Response.SaveToDirectory(@"C:\Downloads");
    response.Response.SaveToFile(@"C:\Downloads\custom_name.txt");
}
```

### レコードから添付ファイルのGUIDを取得して保存

```csharp
// まずレコードを取得
var recordResponse = await client.GetRecordAsync(recordId: 123);

if (recordResponse.IsSuccess && recordResponse.Response?.Data != null)
{
    var record = recordResponse.Response.Data.First();
    
    // 添付ファイル項目からGUIDを取得（例: AttachmentsA）
    if (record.AttachmentsHash != null && 
        record.AttachmentsHash.TryGetValue("AttachmentsA", out var attachments))
    {
        foreach (var attachment in attachments)
        {
            if (!string.IsNullOrEmpty(attachment.Guid))
            {
                // 添付ファイルを取得
                var attachmentResponse = await client.GetAttachmentAsync(attachment.Guid);
                
                if (attachmentResponse.IsSuccess && attachmentResponse.Response != null)
                {
                    // ディレクトリを指定して保存
                    var savedPath = await attachmentResponse.Response.SaveToDirectoryAsync(@"C:\Downloads");
                    Console.WriteLine($"保存先: {savedPath}");
                }
            }
        }
    }
}
```

## ヘルパーメソッド

`AttachmentResponse` には以下のヘルパーメソッドが用意されています：

| メソッド | 説明 |
|------|------|
| `GetBytes()` | Base64データをバイト配列にデコードします |
| `SaveToFile(string filePath)` | 指定したファイルパスに保存します（同期） |
| `SaveToFileAsync(string filePath)` | 指定したファイルパスに保存します（非同期） |
| `SaveToDirectory(string directoryPath)` | 指定したディレクトリに元のファイル名で保存し、保存先パスを返します（同期） |
| `SaveToDirectoryAsync(string directoryPath)` | 指定したディレクトリに元のファイル名で保存し、保存先パスを返します（非同期） |

## 注意事項

- このAPIではファイルの情報をBase64エンコードされた形式で取得します
- 実際のファイルとして使用するには `GetBytes()` メソッドまたは `Convert.FromBase64String()` でデコードしてください
- 添付ファイルのGUIDは、単一レコード取得APIで取得したレコードの `AttachmentsHash` から取得できます

## 関連ドキュメント

- [レスポンスの処理](00-レスポンスの処理) - APIレスポンスの処理方法
- [単一レコード取得](01-テーブル操作-単一レコード取得)
