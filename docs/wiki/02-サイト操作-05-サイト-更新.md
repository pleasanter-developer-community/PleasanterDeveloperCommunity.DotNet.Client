# サイトの更新 - items/{siteId}/updatesite

## 概要

APIを使用してサイト設定を更新します。

## 対応バージョン

- プリザンター 1.3.13.0以降
  - このライブラリの制約によるもの

## 制限事項

- テナント管理者権限が必要です

## メソッド

```csharp
// パラメータ指定版
Task<ApiResponse<UpdateSiteResponse>> UpdateSiteAsync(
    long siteId,
    string? title = null,
    SiteReferenceType? referenceType = null,
    int? tenantId = null,
    long? parentId = null,
    long? inheritPermission = null,
    SiteSettings? siteSettings = null,
    TimeSpan? timeout = null)

// リクエストモデル版
Task<ApiResponse<UpdateSiteResponse>> UpdateSiteAsync(
    long siteId,
    UpdateSiteRequest request,
    TimeSpan? timeout = null)
```

## パラメータ

| 引数                | 型                 | 必須 | 説明                                   |
|---------------------|--------------------|:----:|----------------------------------------|
| `siteId`            | long               | Yes  | サイトID（更新対象のサイトのID）       |
| `title`             | string?            |      | サイトのタイトル                       |
| `referenceType`     | SiteReferenceType? |      | 参照タイプ                             |
| `tenantId`          | int?               |      | テナントID                             |
| `parentId`          | long?              |      | 親サイトID                             |
| `inheritPermission` | long?              |      | アクセス権の継承元サイトID             |
| `siteSettings`      | SiteSettings?      |      | サイト設定（型安全なサイト設定クラス） |
| `timeout`           | TimeSpan?          |      | リクエストタイムアウト                 |

## SiteReferenceType（参照タイプ）

| 値                          | 説明             |
|-----------------------------|------------------|
| `SiteReferenceType.Sites`   | フォルダ         |
| `SiteReferenceType.Issues`  | 期限付きテーブル |
| `SiteReferenceType.Results` | 記録テーブル     |
| `SiteReferenceType.Wikis`   | Wiki             |

## 使用例

### サイトのタイトルを更新

```csharp
// サイトのタイトルを更新
var result = await client.UpdateSiteAsync(
    siteId: 12345,
    title: "更新後のタイトル");

if (result.IsSuccess)
{
    Console.WriteLine($"サイトID: {result.Response?.Id} を更新しました");
}
```

### サイト設定を更新

```csharp
using PleasanterDeveloperCommunity.DotNet.Client.Models.Common;
using PleasanterDeveloperCommunity.DotNet.Client.Models.Requests.Types;

// SiteSettingsクラスを使用して型安全にサイト設定を指定
var siteSettings = new SiteSettings
{
    Version = 1.017m,
    GridColumns = new List<string> { "IssueId", "TitleBody", "Status", "Manager", "Owner" },
    EditorColumnHash = new Dictionary<string, List<string>>
    {
        ["General"] = new List<string> { "IssueId", "Ver", "Title", "Body", "Status", "Manager", "Owner", "Comments" }
    }
};

var result = await client.UpdateSiteAsync(
    siteId: 12345,
    title: "タスク管理（更新）",
    referenceType: SiteReferenceType.Issues,
    siteSettings: siteSettings);

if (result.IsSuccess)
{
    Console.WriteLine($"サイトID: {result.Response?.Id} を更新しました");
}
```

### アクセス権の継承先を変更

```csharp
// アクセス権の継承元を変更
var result = await client.UpdateSiteAsync(
    siteId: 12345,
    inheritPermission: 67890);

if (result.IsSuccess)
{
    Console.WriteLine("アクセス権の継承元を変更しました");
}
```

### 既存のサイト設定を取得して編集（推奨パターン）

サイト設定を更新する場合は、既存の設定を取得してから必要な部分のみを編集し、再セットすることを推奨します。
これにより、意図しない設定の上書きを防ぎ、既存の設定を保持できます。

```csharp
using PleasanterDeveloperCommunity.DotNet.Client.Models.Common;

// 1. 既存のサイト設定を取得
var getResult = await client.GetSiteAsync(siteId: 12345);

if (!getResult.IsSuccess)
{
    Console.WriteLine($"サイト取得エラー: {getResult.Message}");
    return;
}

var existingSettings = getResult.Response?.Data?.SiteSettings;
if (existingSettings == null)
{
    Console.WriteLine("サイト設定が取得できませんでした");
    return;
}

// 2. 必要な部分のみを編集
// 例：一覧に表示する列を変更
existingSettings.GridColumns = new List<string>
{
    "IssueId",
    "TitleBody",
    "Status",
    "Manager",
    "Owner",
    "CompletionTime",  // 完了予定日を追加
    "UpdatedTime"
};

// 例：ページサイズを変更
existingSettings.GridPageSize = 50;

// 例：カレンダー機能を有効化
existingSettings.EnableCalendar = true;

// 3. 編集した設定で更新
var updateResult = await client.UpdateSiteAsync(
    siteId: 12345,
    siteSettings: existingSettings);

if (updateResult.IsSuccess)
{
    Console.WriteLine($"サイトID: {updateResult.Response?.Id} の設定を更新しました");
}
else
{
    Console.WriteLine($"更新エラー: {updateResult.Message}");
}
```

### 列の詳細設定を編集する例

```csharp
using PleasanterDeveloperCommunity.DotNet.Client.Models.Common;
using PleasanterDeveloperCommunity.DotNet.Client.Models.Common.SiteSettingModels;

// 既存の設定を取得
var getResult = await client.GetSiteAsync(siteId: 12345);
var settings = getResult.Response?.Data?.SiteSettings;

if (settings != null)
{
    // 列の詳細設定を初期化（nullの場合）
    settings.Columns ??= new List<SiteSettingsColumn>();

    // 特定の列設定を検索して編集
    var statusColumn = settings.Columns.FirstOrDefault(c => c.ColumnName == "Status");
    if (statusColumn != null)
    {
        statusColumn.EditorReadOnly = true;  // 編集時に読み取り専用に設定
    }
    else
    {
        // 存在しない場合は追加
        settings.Columns.Add(new SiteSettingsColumn
        {
            ColumnName = "Status",
            EditorReadOnly = true
        });
    }

    // 更新を実行
    await client.UpdateSiteAsync(siteId: 12345, siteSettings: settings);
}
```

## レスポンス

### 成功時

```csharp
if (result.IsSuccess)
{
    Console.WriteLine($"サイトID: {result.Response?.Id}");
}
```

### エラー時

```csharp
if (!result.IsSuccess)
{
    Console.WriteLine($"エラーメッセージ: {result.Message}");
}
```

## 関連API

- [サイトの作成](02-サイト操作-01-サイト-作成)
- [サイトの取得](02-サイト操作-03-サイト-取得)
