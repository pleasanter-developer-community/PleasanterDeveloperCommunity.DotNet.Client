# 組織のインポート - depts/import

## 概要

CSVファイルをインポートして、組織を一括で作成・更新します。

## 対応バージョン

- プリザンター 1.3.13.0以降
  - このライブラリの制約によるもの

## 必要な権限

- テナント管理者

## メソッド

```csharp
// byte[]版
Task<ApiResponse<ImportResponse>> ImportDeptsAsync(byte[] csvData, string fileName, Encoding? encoding = null, TimeSpan? timeout = null)

// Stream版
Task<ApiResponse<ImportResponse>> ImportDeptsAsync(Stream csvStream, string fileName, Encoding? encoding = null, TimeSpan? timeout = null)

// ファイルパス版
Task<ApiResponse<ImportResponse>> ImportDeptsFromFileAsync(string filePath, Encoding? encoding = null, TimeSpan? timeout = null)
```

## パラメータ

### byte[]版 (`ImportDeptsAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `csvData` | byte[] | Yes | CSVファイルのバイナリデータ |
| `fileName` | string | Yes | ファイル名 |
| `encoding` | Encoding? | | CSVファイルのエンコーディング（`Encoding.UTF8` または `Encoding.GetEncoding(932)`、デフォルト: `Encoding.UTF8`） |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

### Stream版 (`ImportDeptsAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `csvStream` | Stream | Yes | CSVファイルのストリーム |
| `fileName` | string | Yes | ファイル名 |
| `encoding` | Encoding? | | CSVファイルのエンコーディング（`Encoding.UTF8` または `Encoding.GetEncoding(932)`、デフォルト: `Encoding.UTF8`） |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

### ファイルパス版 (`ImportDeptsFromFileAsync`)

| 引数 | 型 | 必須 | 説明 |
|------|------|:----:|------|
| `filePath` | string | Yes | CSVファイルのパス |
| `encoding` | Encoding? | | CSVファイルのエンコーディング。省略時はファイル内容から自動判定されます。 |
| `timeout` | TimeSpan? | | リクエストタイムアウト |

## 使用例

### 基本的なインポート

```csharp
// CSVファイルを読み込んでインポート
var csvData = File.ReadAllBytes("depts.csv");

var result = await client.ImportDeptsAsync(
    csvData: csvData,
    fileName: "depts.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

### ファイルパスを指定してインポート（推奨）

```csharp
// ファイルパスを直接指定してインポート（最もシンプル）
// encodingを省略するとファイル内容から自動判定
var result = await client.ImportDeptsFromFileAsync(
    filePath: @"C:\data\depts.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

### UTF-8エンコーディングでインポート

```csharp
using System.Text;

var csvData = File.ReadAllBytes("depts.csv");

var result = await client.ImportDeptsAsync(
    csvData: csvData,
    fileName: "depts.csv",
    encoding: Encoding.UTF8);  // 省略可能（デフォルト）
```

### Shift-JISエンコーディングでインポート

```csharp
using System.Text;

var csvData = File.ReadAllBytes("depts_sjis.csv");

var result = await client.ImportDeptsAsync(
    csvData: csvData,
    fileName: "depts_sjis.csv",
    encoding: Encoding.GetEncoding(932));  // Shift-JIS
```

### Streamを使用したインポート

```csharp
using var fileStream = File.OpenRead(@"C:\data\depts.csv");

var result = await client.ImportDeptsAsync(
    csvStream: fileStream,
    fileName: "depts.csv");

if (result.IsSuccess)
{
    Console.WriteLine($"メッセージ: {result.Message}");
}
```

## レスポンス

### 成功時

```json
{
  "Id": 0,
  "StatusCode": 200,
  "Message": "3件の組織をインポートしました。"
}
```

### エラー時

```json
{
  "Id": 0,
  "StatusCode": 403,
  "Message": "権限がありません。"
}
```

## レスポンスの処理

```csharp
var result = await client.ImportDeptsFromFileAsync(@"C:\data\depts.csv");

if (result.IsSuccess)
{
    // 成功時の処理
    Console.WriteLine($"メッセージ: {result.Message}");
}
else
{
    // エラー時の処理
    Console.WriteLine($"エラー: {result.StatusCode} - {result.Message}");
}
```

## CSVフォーマット

CSVファイルには以下の列を含めることができます：

| 列名 | 説明 | 必須 |
|------|------|:----:|
| `DeptCode` | 組織コード | Yes |
| `DeptName` | 組織名 | Yes |
| `Body` | 説明 | |
| `Disabled` | 無効フラグ | |

> **Note:** CSVの詳細なフォーマットについては、[プリザンター公式マニュアル](https://pleasanter.org/ja/manual)を参照してください。

## 注意事項

- テナント管理者権限が必要です
- 既存の組織は `DeptCode` をキーとして更新されます

## 関連項目

- [組織の取得](05-組織操作-01-組織-取得)
- [組織の作成](05-組織操作-02-組織-作成)
- [組織の更新](05-組織操作-03-組織-更新)
- [組織の削除](05-組織操作-04-組織-削除)
